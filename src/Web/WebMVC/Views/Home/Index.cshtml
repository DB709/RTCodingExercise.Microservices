@using System.Globalization
@using System.Data.SqlClient
@using WebMVC.Models
@model PlateListModel
<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">


@{
    ViewData["Title"] = "Home Page";
}
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

<div class="text-center">
    <h1 class="display-4">License Plate Search Engine</h1>
    <div class="d-flex justify-content-between mb-3">
        <div>
            @using (Html.BeginForm("Index", "Home", FormMethod.Get))
            {
                <div class="input-group">
                    <input type="text" name="searchText" />
                    <div class="input-group-append">
                        <input type="submit" class="btn btn-primary" value="Search" />
                    </div>
                </div>
            }
        </div>
        <div>
            <button type="button" id="addLicensePlate" class="btn btn-primary float-right">Add License Plate</button>
        </div>
    </div>
    <div id="addLicensePlateForm" style="display:none;">
        <h3>Add License Plate</h3>
        @using (Html.BeginForm("AddLicensePlate", "Home", FormMethod.Post))
        {
            <label for="registration">Registration:</label>
            <input type="text" id="registration" name="Registration" required />

            <label for="purchasePrice">Purchase Price:</label>
            <input type="number" id="purchasePrice" name="PurchasePrice" required />

            <label for="salePrice">Sale Price:</label>
            <input type="number" id="salePrice" name="SalePrice" required />

            <input type="submit" class="btn btn-primary" value="Add" />
        }
    </div>
    <div>
        <table class="table">
            <thead>
                <tr>
                    <th>Registration</th>
                    <th>Purchase Price</th>
                    <th>
                        Sale Price 
                            <a href="@Url.Action("Index", new { salePriceOrder = SortOrder.Ascending })" class="btn btn-secondary"><i class="bi bi-arrow-up"></i></a>
                            <a href="@Url.Action("Index", new { salePriceOrder = SortOrder.Descending })" class="btn btn-secondary"><i class="bi bi-arrow-down"></i></a>
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var plate in Model.Plates)
                {
                    <tr>
                        <td>@plate.Registration</td>
                        <td>@plate.PurchasePrice.ToString("C", CultureInfo.CreateSpecificCulture("en-GB"))</td>
                        <td>@plate.SalePrice.ToString("C", CultureInfo.CreateSpecificCulture("en-GB"))</td>
                    </tr>
                }
            </tbody>
        </table>
        <ul class="pagination justify-content-evenly">
        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            <li class="page-item"><a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a></li>
        }
        </ul>
    </div>

    <script>
        $(document).ready(function () {
            $('#addLicensePlate').click(function () {
                $('#addLicensePlateForm').show();
            });
            $('#addLicensePlateForm').validate({
                rules: {
                    Registration: {
                        required: true,
                        minlength: 2,
                        maxlength: 7
                    },
                    PurchasePrice: {
                        required: true,
                        number: true,
                        min: 0
                    },
                    BuyPrice: {
                        required: true,
                        number: true,
                        min: 0
                    }
                },
                messages: {
                    Registration: {
                        required: "Please enter the registration",
                        minlength: "Registration must be at least 2 characters long",
                        maxlength: "Registration must not exceed 7 characters"
                    },
                    PurchasePrice: {
                        required: "Please enter the purchase price",
                        number: "Sale price must be a number",
                        min: "Sale price cannot be negative"
                    },
                    SalePrice: {
                        required: "Please enter the sale price",
                        number: "Sale price must be a number",
                        min: "Sale price cannot be negative"
                    }
                }
            });
        });
    </script>
</div>